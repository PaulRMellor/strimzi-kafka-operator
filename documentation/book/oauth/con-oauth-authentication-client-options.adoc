// Module included in the following assemblies:
//
// assembly-oauth.adoc

[id='con-oauth-authentication-client-options-{context}']
= {oauth} client authentication options

In this section, we outline configuration options for Kafka clients and Kafka brokers using {oauth} token based authentication when establishing a session with a Kafka broker.

When a Kafka client sends an access token as credentials to a Kafka broker (the resource server), the token needs to be validated.

Depending on the authorization server used, and the configuration options available, you may prefer to use:

* Signed JWT tokens that are validated without contacting the authorization server
* Fast local token validation without checking with the authorization server

Using JWT access tokens requires the authorization server to provide a JWKS endpoint with public certificates that are used to validate signatures on the tokens.

NOTE: An authorization server might only allow the use of opaque access tokens, which means that local token validation is not possible.

Another option is to use an {oauth} introspection endpoint on the authorization server.
Each time a Kafka broker connection is established, the broker sends the access token it receives to the authorization server, and a response confirming whether or not the token is valid is returned.

Kafka client credentials can also be configured for:

* Direct local access using a previously generated long-lived access token
* Contact with the authorization server for a new access token to be issued and sent to the Kafka broker

== Client authentication flows

Here you can see example flows using the following {oauth} client authentication options.

* xref:oauth-introspection-endpoint[Authorization server authentication using an introspection endpoint]
* xref:oauth-jwt[Authorization server authentication using a local JWT token signature validation]
* xref:oauth-token-endpoint[Authentication using a long-lived access token and introspection endpoint]
* xref:oauth-token-jwt[Authentication using a long-lived token and a local JWT token signature validation]

[id='oauth-introspection-endpoint']
.Authorization server authentication using an introspection endpoint

image:oauth-introspection-endpoint.png[Authorization server authentication using an introspection endpoint]

. Kafka client authenticates with the authorization server using a client ID and secret.
. An access token is returned by the authorization server.
. Kafka client authenticates with the Kafka broker using the access token.
. Kafka broker validates the access token by calling a token introspection endpoint provided by the authorization server
. Kafka client session is established.

[id='oauth-jwt']
.Authorization server authentication using a local JWT token signature validation

image:oauth-jwt-signature.png[Authorization server authentication using a local JWT token signature]

. Kafka client authenticates with the authorization server using a client ID, an authentication secret and a refresh token.
. An access token is returned by the authorization server.
. Client authenticates with the Kafka broker using the access token.
. Kafka broker validates the access token locally using a JWT token signature and the Kafka client session is established.

[id='oauth-token-endpoint']
.Authentication using a long-lived access token and introspection endpoint

image:oauth-introspection-endpoint-long-token.png[Authentication using a long-lived access token and introspection endpoint]

. Kafka client authenticates with the Kafka Broker using a long-lived access token.
. Kafka broker validates the access token by calling a token introspection endpoint provided by the authorization server
. Kafka client session is established.

[id='oauth-token-jwt']
.Authentication using a long-lived token and a local JWT token signature validation

image:oauth-jwt-signature-token.png[Authentication using a long-lived access token and introspection endpoint]

. Kafka client authenticates with the Kafka broker using the access token.
. Kafka broker validates the access token locally using a JWT token signature and the client session is established.

WARNING: Fast local JWT token signature validation is suitable only for short-lived tokens as there is no check with the authorization server that a token has been revoked.
Token expiration is written into the token, so revocation is not accounted for. Any issued token would be considered valid until it expires.
