// Module included in the following assemblies:
//
// assembly-scheduling.adoc

[id='configuring-pod-anti-affinity-in-kafka-components-{context}']
= Configuring pod anti-affinity against other workloads

[role="_abstract"]
To improve the stability and performance of your Kafka cluster, you can prevent its pods from running on the same worker nodes as other resource-intensive applications. 

Using `podAntiAffinity` in your `KafkaNodePool` resource tells Kubernetes to avoid scheduling Kafka nodes from the same pool alongside specific workloads, such as databases or other messaging systems.

.Prerequisites

* A Kubernetes cluster
* A running Cluster Operator

.Procedure

. In your `KafkaNodePool` custom resource, edit the `affinity` property in the `spec.template.pod` section.
+
To prevent Kafka pods from the same node pool sharing a worker node with other application pods, add a `podAntiAffinity` rule.
+
* Use a `labelSelector` to identify the pods to keep separate from your Kafka nodes.
* Set the `topologyKey` to `"kubernetes.io/hostname"`. 
This defines each worker node as a separate domain for the scheduling rule, preventing the targeted pods from being placed on the same host.
+
.Example anti-affinity configuration against other workloads
[source,yaml,subs=attributes+]
----
apiVersion: {KafkaNodePoolApiVersion}
kind: KafkaNodePool
metadata:
  name: broker
  labels:
    strimzi.io/cluster: my-cluster
spec:
  replicas: 3
  roles:
    - broker
  template:
    pod:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchExpressions:
                  - key: application
                    operator: In
                    values:
                      - postgresql
                      - mongodb
              topologyKey: "kubernetes.io/hostname"
  # ...
----

. Apply the changes to the `KafkaNodePool` configuration.