// Module included in the following assemblies:
//
// assembly-securing-kafka-brokers.adoc

[id='con-securing-kafka-authentication-{context}']
= Listener authentication

You can create `plain` (without encryption) or `tls` listener types.
For clients outside the Kubernetes cluster, you create `external` listeners and specify a connection mechanism, which can be `nodeport`, `loadbalancer`, `ingress` or `route` (on OpenShift).

Supported authentication options:

. Mutual TLS authentication (only on the listeners with TLS encryption)
. SCRAM-SHA authentication
. xref:assembly-oauth-authentication_str[OAuth 2.0 token based authentication]

.Kafka listener authentication options
image::listener-config-options.png[options for listener authentication configuration]

The listener `authentication` property is used to specify an authentication mechanism specific to that listener.

The listener authentication mechanism is defined by the `type` field.
If no `authentication` property is specified then the listener does not authenticate clients which connect through that listener.
The listener will accept all connections without authentication.

Authentication must be configured when using the User Operator to manage `KafkaUsers`.

The following example shows:

* A `plain` listener configured for SCRAM-SHA authentication
* A `tls` listener with mutual TLS authentication
* An `external` listener with mutual TLS authentication

.An example showing listener authentication configuration
[source,yaml,subs="attributes+"]
----
# ...
listeners:
  plain:
    authentication:
      type: scram-sha-512
  tls:
    authentication:
      type: tls
  external:
    type: loadbalancer
    tls: true
    authentication:
      type: tls
# ...
----

[id='con-mutual-tls-authentication-{context}']
== Mutual TLS authentication

Mutual TLS authentication is always used for the communication between Kafka brokers and ZooKeeper pods.

For mutual authentication or two-way authentication, both the server and the client present certificates.
Strimzi can configure Kafka to use TLS (Transport Layer Security) to provide encrypted communication between Kafka brokers and clients either with or without mutual authentication. When you configure mutual authentication, the broker authenticates the client and the client authenticates the broker.

NOTE: TLS authentication is more commonly one-way, with one party authenticating the identity of another. For example, when HTTPS is used between a web browser and a web server, the server obtains proof of the identity of the browser.

.When to use mutual TLS authentication for clients

Mutual TLS authentication is recommended for authenticating Kafka clients when:

* The client supports authentication using mutual TLS authentication
* It is necessary to use the TLS certificates rather than passwords
* You can reconfigure and restart client applications periodically so that they do not use expired certificates.

[id='con-scram-sha-authentication-{context}']
== SCRAM-SHA authentication

SCRAM (Salted Challenge Response Authentication Mechanism) is an authentication protocol that can establish mutual authentication using passwords. Strimzi can configure Kafka to use SASL (Simple Authentication and Security Layer) SCRAM-SHA-512 to provide authentication on both unencrypted and TLS-encrypted client connections. TLS authentication is always used internally between Kafka brokers and ZooKeeper nodes. When used with a TLS client connection, the TLS protocol provides encryption, but is not used for authentication.

The following properties of SCRAM make it safe to use SCRAM-SHA even on unencrypted connections:

* The passwords are not sent in the clear over the communication channel.
Instead the client and the server are each challenged by the other to offer proof that they know the password of the authenticating user.

* The server and client each generate a new challenge for each authentication exchange.
This means that the exchange is resilient against replay attacks.

.Supported SCRAM credentials

Strimzi supports SCRAM-SHA-512 only.
When a `KafkaUser.spec.authentication.type` is configured with `scram-sha-512` the User Operator will generate a random 12 character password consisting of upper and lowercase ASCII letters and numbers.

.When to use SCRAM-SHA authentication for clients

SCRAM-SHA is recommended for authenticating Kafka clients when:

* The client supports authentication using SCRAM-SHA-512
* It is necessary to use passwords rather than the TLS certificates
* Authentication for unencrypted communication is required

.Additional resources

* {Externallisteners}

[id='assembly-kafka-broker-listener-network-policies-{context}']
== Network policies

Strimzi automatically creates a `NetworkPolicy` resource for every listener that is enabled on a Kafka broker.
By default, a `NetworkPolicy` grants access to a listener to all applications and namespaces.

If you want to restrict access to a listener at the network level to only selected applications or namespaces,
use the `networkPolicyPeers` property.

Use network policies as part of the listener authentication configuration.
Each listener can have a different `networkPolicyPeers` configuration.

For more information, refer to the xref:con-common-configuration-listener-network-policy-reference[Listener network policies] section and the {K8sNetworkPolicyPeerAPI}.

NOTE: Your configuration of Kubernetes must support ingress `NetworkPolicies` in order to use network policies in Strimzi.
