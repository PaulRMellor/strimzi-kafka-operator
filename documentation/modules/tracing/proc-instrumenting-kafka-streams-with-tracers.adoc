// Module included in the following assemblies:
//
// assembly-instrumenting-kafka-clients-tracers.adoc

[id='proc-instrumenting-kafka-streams-with-tracers-{context}']
= Instrumenting Kafka Streams applications for tracing

[role="_abstract"]
This procedure describes how to instrument Kafka Streams API applications for distributed tracing.

The procedure shows the steps required when using OpenTracing.

You enable Kafka OpenTracing instrumentation in Kafka Streams applications by adding the JARs as a dependency to your project.
You create a Kafka Streams instance that uses `KafkaClientSupplier`.
`KafkaClientSupplier` tells the Streams API to use wrapped Kafka consumer and producer clients.
A `TracingKafkaClientSupplier` class is provided by the Kafka Open Tracing instrumentation project.

To instrument Kafka Streams with OpenTelemetry, you'll need to write your a custom `TracingKafkaClientSupplier`.

.Procedure

In each Kafka Streams API application:

. Add the `opentracing-kafka-streams` dependency to the pom.xml file for your Kafka Streams API application:
+
[source,xml,subs="attributes+"]
----
<dependency>
    <groupId>io.opentracing.contrib</groupId>
    <artifactId>opentracing-kafka-streams</artifactId>
    <version>{OpenTracingKafkaClient}</version>
</dependency>
----

. Create an instance of the `TracingKafkaClientSupplier` supplier interface:
+
[source,java,subs=attributes+]
----
KafkaClientSupplier supplier = new TracingKafkaClientSupplier(tracer);
----

. Provide the supplier interface to `KafkaStreams`:
+
[source,java,subs=attributes+]
----
KafkaStreams streams = new KafkaStreams(builder.build(), new StreamsConfig(config), supplier);
streams.start();
----
